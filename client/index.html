<!DOCTYPE html>
<html>
	<head>
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
		<style>
body {
	font-family: sans-serif;
}
h1 {
	font-size: 2em;
	padding: 0; padding-top: 1.5em; padding-bottom: 0.75em;
	text-align: center;
	font-family: "Roboto Condensed", sans-serif;
	font-weight: 400;
	font-style: normal;
}
.grid {
	margin-top: 1em;
	display: flex;
	justify-content: center;
	flex-wrap: wrap;
}
.card {
	display: inline-block;
	height: max-content;
	box-shadow: 0em 0.5em 1.5em 0em black;
	margin: 1em;
	padding: 1em;
	border: 0.25em solid black;
	border-radius: 0.5em;
}
.card > div:first-child {
	font-weight: bold;
	& + div {
		color: #888;
		& + div {
			color: #888;
		}
	}
}
a, button {
	font-size: 1em;
	margin: 0.25em;
	border: none;
	border-radius: 0.5em;
	background: #222;
	padding: 0.5em;
	color: white;
	text-decoration: none;
}
:is(a, button).accent-button {
	font-weight: bold;
	background: #00F;
}
		</style>
	</head>
	<body>
		<h1>Draw 2</h1>
		<div class="grid" id="whiteboards"><span>Loading...</span></div>
		<div class="grid">
			<button class="accent-button" style="box-shadow: 0em 0.25em 0.75em 0em black;" onclick="newWhiteboard()">New whiteboard</div>
		</div>
		<script>
(() => {
	var x = new XMLHttpRequest()
	x.open("GET", "/whiteboard_data/ls")
	x.addEventListener("loadend", () => {
		document.querySelector("#whiteboards")?.firstChild?.remove()
		/** @type {{ name: string, created: string, id: string }[]} */
		var data = JSON.parse(x.responseText)
		if (data.length == 0) {
			var e = document.createElement("div")
			e.classList.add("card")
			e.innerText = "No whiteboards available"
			document.querySelector("#whiteboards")?.appendChild(e)
			return
		}
		for (var i = 0; i < data.length; i++) {
			var whiteboardData = data[i];
			// Create card element
			var e = document.createElement("div")
			e.classList.add("card")
			e.appendChild(document.createElement("div")).innerText = whiteboardData.name
			e.appendChild(document.createElement("div")).innerText = new Date(whiteboardData.created).toDateString()
			var msDiff = new Date().getTime() - new Date(whiteboardData.created).getTime();
			e.appendChild(document.createElement("div")).innerText = `${Math.floor(msDiff / (1000 * 60 * 60 * 24))} days ago`
			var menu = e.appendChild(document.createElement("div"))
			// Open Button
			var openbtn = menu.appendChild(document.createElement("a"))
			openbtn.innerText = "Open";
			openbtn.classList.add("accent-button");
			openbtn.setAttribute("href", `/whiteboard/${whiteboardData.id}/`);
			// Rename Button
			var renamebtn = menu.appendChild(document.createElement("button"))
			renamebtn.innerText = "Rename";
			renamebtn.addEventListener("click", () => {
				var newname = prompt("Enter the new name", whiteboardData.name)
				if (newname == null) return
				var x = new XMLHttpRequest()
				x.open("POST", "/rename")
				x.addEventListener("loadend", () => {
					location.reload()
				})
				x.send(id + "\n" + newname)
			});
			document.querySelector("#whiteboards")?.appendChild(e)
		}
	})
	x.send()
})();
function newWhiteboard() {
	var name = prompt("Enter the whiteboard name")
	if (name == null) return
	var x = new XMLHttpRequest()
	x.open("POST", "/new")
	x.addEventListener("loadend", () => {
		location.assign("/whiteboard/" + x.responseText + "/")
	})
	x.send(name)
}
		</script>
	</body>
</html>
